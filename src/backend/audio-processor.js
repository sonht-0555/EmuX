class AudioProcessor extends AudioWorkletProcessor{constructor(){super(),this.bufferSize=16384,this.leftBuffer=new Float32Array(this.bufferSize),this.rightBuffer=new Float32Array(this.bufferSize),this.writePosition=0,this.readPosition=0,this.ratio=1,this.volume=1,this.silenceTimer=0,this.port.onmessage=i=>{if(this.silenceTimer=0,i.data.ratio)return void(this.ratio=i.data.ratio);const{l:t,r:e}=i.data;for(let i=0;i<t.length;i++)this.leftBuffer[this.writePosition]=t[i],this.rightBuffer[this.writePosition]=e[i],this.writePosition=(this.writePosition+1)%this.bufferSize}}interpolate(i,t){const e=0|t,s=t-e,r=this.bufferSize-1,o=i[e-1&r],h=i[e&r],f=i[e+1&r],u=i[e+2&r];return(h+.5*s*(f-o+s*(2*o-5*h+4*f-u+s*(3*(h-f)+u-o))))*this.volume}process(i,t){const e=t[0],s=e[0],r=e[1],o=s.length;let h=this.readPosition,f=this.writePosition-(0|h)+this.bufferSize&this.bufferSize-1;const u=this.ratio*(f>.7*this.bufferSize?1.005:f<4800?.995:1);if(this.silenceTimer++,this.silenceTimer>6?this.volume=Math.max(0,this.volume-.1):f>1024&&(this.volume=Math.min(1,this.volume+.05)),r)for(let i=0;i<o;i++)f>8?(s[i]=this.interpolate(this.leftBuffer,h),r[i]=this.interpolate(this.rightBuffer,h),h+=u,h>=this.bufferSize&&(h-=this.bufferSize),f-=u):(s[i]=0,r[i]=0);else for(let i=0;i<o;i++)f>8?(s[i]=this.interpolate(this.leftBuffer,h),h+=u,h>=this.bufferSize&&(h-=this.bufferSize),f-=u):s[i]=0;return this.readPosition=h,!0}}registerProcessor("audio-processor",AudioProcessor);