let context2d,context2dBottom,imageData,imageDataBottom,pixelBuffer,pixelBufferBottom,lastMainFrame,lastBottomFrame,lastView16as32,sourceView32,sourceView16,lastMainFramePtr=0,lastBottomFramePtr=0;function render32(e,t,a,r,o,i,n,l){frameCount++;const s=Module._retro_is_dirty||Module.asm&&Module.asm._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports.retro_is_dirty;if(s&&r){if(s(e.byteOffset+(t<<2),r,l<<2)){for(let r=0,i=t;r<l;r++,i++){const t=a[r]=e[i];o[r]=4278190080|(255&t)<<16|65280&t|t>>16&255}return void i.putImageData(n,0,0)}}else{const r=new BigUint64Array(e.buffer,e.byteOffset+(t<<2),l>>1),s=new BigUint64Array(a.buffer,0,l>>1);for(let d=r.length-1;d>=0;d--)if(r[d]!==s[d]){for(let r=0,i=t;r<l;r++,i++){const t=a[r]=e[i];o[r]=4278190080|(255&t)<<16|65280&t|t>>16&255}return void i.putImageData(n,0,0)}}skippedFrames++}function render16(e,t,a,r,o,i,n,l,s,d){frameCount++;const c=l>>1,u=d>>1,m=Module._retro_is_dirty||Module.asm&&Module.asm._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports.retro_is_dirty;if(m&&r){if(m(t.byteOffset,r,l*s<<1)){for(let r=0;r<s;r++){const i=r*d,n=r*l,s=r*u,m=r*c;for(let r=0;r<c;r++){const l=r<<1;o[n+l]=lookupTable565[e[i+l]],o[n+l+1]=lookupTable565[e[i+l+1]],a[m+r]=t[s+r]}}return void i.putImageData(n,0,0)}}else for(let r=s-1;r>=0;r--){const m=r*u,f=r*c;for(let r=c-1;r>=0;r--)if(t[m+r]!==a[f+r]){for(let r=0;r<s;r++){const i=r*d,n=r*l,s=r*u,m=r*c;for(let r=0;r<c;r++){const l=r<<1;o[n+l]=lookupTable565[e[i+l]],o[n+l+1]=lookupTable565[e[i+l+1]],a[m+r]=t[s+r]}}return void i.putImageData(n,0,0)}}skippedFrames++}function renderNDS(e,t,a){const r=a>>1,o=t*r,i=Module.HEAPU8.buffer;cachedWidth===t&&cachedHeight===r||(cachedWidth=t,cachedHeight=r,Module.canvas.width=canvasB.width=t,Module.canvas.height=canvasB.height=r,pixelBuffer=new Uint32Array(imageData.data.buffer),pixelBufferBottom=new Uint32Array(imageDataBottom.data.buffer),lastMainFramePtr&&Module._free(lastMainFramePtr),lastBottomFramePtr&&Module._free(lastBottomFramePtr),lastMainFramePtr=Module._malloc(o<<2),lastBottomFramePtr=Module._malloc(o<<2),lastMainFrame=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,o),lastBottomFrame=new Uint32Array(Module.HEAPU8.buffer,lastBottomFramePtr,o),sourceView32=null,window.gameView&&gameView(gameName)),sourceView32&&sourceView32.buffer===i&&ndsPointer===e||(ndsPointer=e,sourceView32=new Uint32Array(i,e,t*a)),render32(sourceView32,0,lastMainFrame,lastMainFramePtr,pixelBuffer,context2d,imageData,o),render32(sourceView32,o,lastBottomFrame,lastBottomFramePtr,pixelBufferBottom,context2dBottom,imageDataBottom,o),logSkip()}window.activeRenderFn=function(e,t,a,r){if(context2d||(context2d=Module.canvas.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1}),Module.isNDS&&(page02.style.paddingTop="5px",canvasB.style.display="block",joypad.style.justifyContent="center",joy.style.display="none",context2dBottom=canvasB.getContext("2d",{alpha:!1,desynchronized:!0,willReadFrequently:!1}))),Module.isNDS)return renderNDS(e,t,a);const o=t*a,i=r===t<<2,n=Module.HEAPU8.buffer;t===cachedWidth&&a===cachedHeight&&r===cachedPitch||(cachedWidth=t,cachedHeight=a,cachedPitch=r,cachedBuffer=null,Module.canvas.width=t,Module.canvas.height=a,imageData=context2d.createImageData(t,a),pixelBuffer=new Uint32Array(imageData.data.buffer),i?(lastMainFramePtr&&Module._free(lastMainFramePtr),lastMainFramePtr=Module._malloc(o<<2),lastMainFrame=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,o)):(lastMainFramePtr&&Module._free(lastMainFramePtr),lastMainFramePtr=Module._malloc(o<<1),lastView16as32=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,o>>1)),window.gameView&&gameView(gameName)),n===cachedBuffer&&e===cachedPointer||(cachedBuffer=n,cachedPointer=e,sourceView32=new Uint32Array(n,e,i?o:(r>>1)*a>>1),i||(sourceView16=new Uint16Array(n,e,(r>>1)*a))),i?render32(sourceView32,0,lastMainFrame,lastMainFramePtr,pixelBuffer,context2d,imageData,o):render16(sourceView16,sourceView32,lastView16as32,lastMainFramePtr,pixelBuffer,context2d,imageData,t,a,r>>1),logSkip()},console.log("w2d.js loaded");