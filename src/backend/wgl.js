let glContext,glContextBottom,shaderProgram,shaderProgramBottom,glTexture,glTextureBottom,lastMainFrame,lastBottomFrame,pixelBuffer,pixelBufferBottom,pixelView,pixelViewBottom,lastView16as32,sourceView32,sourceView16,lastMainFramePtr=0,lastBottomFramePtr=0,textureInitializedMain=0,textureInitializedBottom=0;const vertexShaderSource="attribute vec2 p;attribute vec2 t;varying vec2 v;void main(){gl_Position=vec4(p,0,1);v=t;}",fragmentShaderSource="precision mediump float;varying vec2 v;uniform sampler2D s;void main(){gl_FragColor=texture2D(s,v);}";function initGL(e){const t=e.getContext("webgl",{alpha:!1,antialias:!1,desynchronized:!0,preserveDrawingBuffer:!1,powerPreference:"high-performance"});if(!t)return null;const r=t.createShader(t.VERTEX_SHADER);t.shaderSource(r,vertexShaderSource),t.compileShader(r);const a=t.createShader(t.FRAGMENT_SHADER);t.shaderSource(a,fragmentShaderSource),t.compileShader(a);const i=t.createProgram();t.attachShader(i,r),t.attachShader(i,a),t.linkProgram(i),t.useProgram(i);const o=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t.STATIC_DRAW);const n=t.getAttribLocation(i,"p");t.enableVertexAttribArray(n),t.vertexAttribPointer(n,2,t.FLOAT,!1,0,0);const l=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,l),t.bufferData(t.ARRAY_BUFFER,new Float32Array([0,1,1,1,0,0,0,0,1,1,1,0]),t.STATIC_DRAW);const u=t.getAttribLocation(i,"t");t.enableVertexAttribArray(u),t.vertexAttribPointer(u,2,t.FLOAT,!1,0,0);const s=t.createTexture();return t.bindTexture(t.TEXTURE_2D,s),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),{context:t,prog:i,tex:s}}function render32(e,t,r,a,i,o,n,l,u,s,d,c){frameCount++;const m=Module._retro_is_dirty||Module.asm&&Module.asm._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports.retro_is_dirty;if(m&&a){if(m(e.byteOffset+(t<<2),a,d<<2)){for(let a=0,o=t;a<d;a++,o++){const t=r[a]=e[o];i[a]=4278190080|(255&t)<<16|65280&t|t>>16&255}return n.bindTexture(n.TEXTURE_2D,l),(c?textureInitializedBottom:textureInitializedMain)?n.texSubImage2D(n.TEXTURE_2D,0,0,0,u,s,n.RGBA,n.UNSIGNED_BYTE,o):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,u,s,0,n.RGBA,n.UNSIGNED_BYTE,o),c?textureInitializedBottom=1:textureInitializedMain=1),void n.drawArrays(n.TRIANGLES,0,6)}}else{const a=new BigUint64Array(e.buffer,e.byteOffset+(t<<2),d>>1),m=new BigUint64Array(r.buffer,0,d>>1);for(let f=a.length-1;f>=0;f--)if(a[f]!==m[f]){for(let a=0,o=t;a<d;a++,o++){const t=r[a]=e[o];i[a]=4278190080|(255&t)<<16|65280&t|t>>16&255}return n.bindTexture(n.TEXTURE_2D,l),(c?textureInitializedBottom:textureInitializedMain)?n.texSubImage2D(n.TEXTURE_2D,0,0,0,u,s,n.RGBA,n.UNSIGNED_BYTE,o):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,u,s,0,n.RGBA,n.UNSIGNED_BYTE,o),c?textureInitializedBottom=1:textureInitializedMain=1),void n.drawArrays(n.TRIANGLES,0,6)}}skippedFrames++}function render16(e,t,r,a,i,o,n,l,u,s,d,c){frameCount++;const m=u>>1,f=d>>1,x=Module._retro_is_dirty||Module.asm&&Module.asm._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports._retro_is_dirty||Module.instance&&Module.instance.exports&&Module.instance.exports.retro_is_dirty;if(x&&a){if(x(t.byteOffset,a,u*s<<1)){for(let a=0;a<s;a++){const o=a*d,n=a*u,l=a*f,s=a*m;for(let a=0;a<m;a++){const u=a<<1;i[n+u]=lookupTable565[e[o+u]],i[n+u+1]=lookupTable565[e[o+u+1]],r[s+a]=t[l+a]}}return n.bindTexture(n.TEXTURE_2D,l),(c?textureInitializedBottom:textureInitializedMain)?n.texSubImage2D(n.TEXTURE_2D,0,0,0,u,s,n.RGBA,n.UNSIGNED_BYTE,o):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,u,s,0,n.RGBA,n.UNSIGNED_BYTE,o),c?textureInitializedBottom=1:textureInitializedMain=1),void n.drawArrays(n.TRIANGLES,0,6)}}else for(let a=s-1;a>=0;a--){const x=a*f,T=a*m;for(let a=m-1;a>=0;a--)if(t[x+a]!==r[T+a]){for(let a=0;a<s;a++){const o=a*d,n=a*u,l=a*f,s=a*m;for(let a=0;a<m;a++){const u=a<<1;i[n+u]=lookupTable565[e[o+u]],i[n+u+1]=lookupTable565[e[o+u+1]],r[s+a]=t[l+a]}}return n.bindTexture(n.TEXTURE_2D,l),(c?textureInitializedBottom:textureInitializedMain)?n.texSubImage2D(n.TEXTURE_2D,0,0,0,u,s,n.RGBA,n.UNSIGNED_BYTE,o):(n.texImage2D(n.TEXTURE_2D,0,n.RGBA,u,s,0,n.RGBA,n.UNSIGNED_BYTE,o),c?textureInitializedBottom=1:textureInitializedMain=1),void n.drawArrays(n.TRIANGLES,0,6)}}skippedFrames++}function renderNDS(e,t,r){const a=r>>1,i=t*a,o=Module.HEAPU8.buffer;cachedWidth===t&&cachedHeight===a||(cachedWidth=t,cachedHeight=a,Module.canvas.width=canvasB.width=t,Module.canvas.height=canvasB.height=a,glContext.viewport(0,0,t,a),glContextBottom.viewport(0,0,t,a),pixelBuffer=new Uint32Array(i),pixelBufferBottom=new Uint32Array(i),pixelView=new Uint8Array(pixelBuffer.buffer),pixelViewBottom=new Uint8Array(pixelBufferBottom.buffer),lastMainFramePtr&&Module._free(lastMainFramePtr),lastBottomFramePtr&&Module._free(lastBottomFramePtr),lastMainFramePtr=Module._malloc(i<<2),lastBottomFramePtr=Module._malloc(i<<2),lastMainFrame=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,i),lastBottomFrame=new Uint32Array(Module.HEAPU8.buffer,lastBottomFramePtr,i),sourceView32=null,textureInitializedMain=textureInitializedBottom=0,window.gameView&&gameView(gameName)),sourceView32&&sourceView32.buffer===o&&ndsPointer===e||(ndsPointer=e,sourceView32=new Uint32Array(o,e,t*r)),render32(sourceView32,0,lastMainFrame,lastMainFramePtr,pixelBuffer,pixelView,glContext,glTexture,t,a,i,0),render32(sourceView32,i,lastBottomFrame,lastBottomFramePtr,pixelBufferBottom,pixelViewBottom,glContextBottom,glTextureBottom,t,a,i,1),logSkip()}window.activeRenderFn=function(e,t,r,a){if(!glContext){const e=initGL(Module.canvas);if(!e)return;if(glContext=e.context,shaderProgram=e.prog,glTexture=e.tex,Module.isNDS){page02.style.paddingTop="5px",canvasB.style.display="block",joypad.style.justifyContent="center",joy.style.display="none";const e=initGL(canvasB);glContextBottom=e.context,shaderProgramBottom=e.prog,glTextureBottom=e.tex}}if(Module.isNDS)return renderNDS(e,t,r);const i=t*r,o=a===t<<2,n=Module.HEAPU8.buffer;t===cachedWidth&&r===cachedHeight&&a===cachedPitch||(cachedWidth=t,cachedHeight=r,cachedPitch=a,cachedBuffer=null,Module.canvas.width=t,Module.canvas.height=r,glContext.viewport(0,0,t,r),pixelBuffer=new Uint32Array(i),pixelView=new Uint8Array(pixelBuffer.buffer),o?(lastMainFramePtr&&Module._free(lastMainFramePtr),lastMainFramePtr=Module._malloc(i<<2),lastMainFrame=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,i)):(lastMainFramePtr&&Module._free(lastMainFramePtr),lastMainFramePtr=Module._malloc(i<<1),lastView16as32=new Uint32Array(Module.HEAPU8.buffer,lastMainFramePtr,i>>1)),textureInitializedMain=0,window.gameView&&gameView(gameName)),n===cachedBuffer&&e===cachedPointer||(cachedBuffer=n,cachedPointer=e,sourceView32=new Uint32Array(n,e,o?i:(a>>1)*r>>1),o||(sourceView16=new Uint16Array(n,e,(a>>1)*r))),o?render32(sourceView32,0,lastMainFrame,lastMainFramePtr,pixelBuffer,pixelView,glContext,glTexture,t,r,i,0):render16(sourceView16,sourceView32,lastView16as32,lastMainFramePtr,pixelBuffer,pixelView,glContext,glTexture,t,r,a>>1,0),logSkip()},console.log("wgl.js loaded");