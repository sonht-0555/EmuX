<!DOCTYPE html>
<html>
<head>
    <title>Shader Logic Test: Single (3,4) vs Double (6+)</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; }
        .grid-container { 
            position: relative; 
            width: 250px; 
            height: 250px; 
            background: #243e2e; 
            border: 2px solid #555;
            image-rendering: pixelated; 
        }
        .shader-overlay {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            mix-blend-mode: overlay;
            background-repeat: repeat;
        }
        .controls { background: #111; padding: 20px; border-radius: 10px; border: 1px solid #333; text-align: center; margin-top: 20px; }
        input { background: #222; color: #fff; border: 1px solid #444; padding: 8px; width: 60px; text-align: center; font-size: 16px; margin: 0 10px; }
        .info { color: #50fa7b; font-size: 15px; margin-top: 10px; font-family: monospace; }
        .label { color: #aaa; margin-bottom: 10px; font-size: 14px; }
    </style>
</head>
<body>

    <div class="label">Preview 2x2 Game Pixels (Check alignment at the white lines)</div>
    <div class="grid-container">
        <div class="shader-overlay" id="overlay"></div>
    </div>

    <div class="controls">
        Integer (Pixel Size): <input type="number" id="int" value="4" oninput="run()">
        <div class="info" id="status"></div>
    </div>

    <script>
        // Logic sinh pattern backslash chuẩn
        function genPattern(n) {
            let cells = [];
            for (let y = 0; y < n; y++) {
                for (let x = 0; x < n; x++) {
                    cells.push((Math.abs(x - y) % n === 0) ? "1" : "0");
                }
            }
            return cells.join('.');
        }

        function svgGen(repeat, size, string) {
            const N = repeat * size;
            const c = document.createElement('canvas');
            c.width = c.height = N;
            const ctx = c.getContext('2d');
            const cells = string.split('.');
            const ps = Math.sqrt(cells.length); 
            for (let i = 0; i < N; i++) {
                for (let j = 0; j < N; j++) {
                    if (cells[Math.floor(i/repeat) * ps + Math.floor(j/repeat)] === '1') {
                        ctx.fillRect(j, i, 1, 1);
                    }
                }
            }
            return `url(${c.toDataURL()})`;
        }

        function run() {
            const n = parseInt(document.getElementById('int').value) || 1;
            
            // QUY LUẬT CỦA BẠN:
            // Integer <= 4: 1 dòng (Single)
            // Integer >= 6 và Chẵn: 2 dòng (Double)
            // Lẻ >= 5: 1 dòng (Single)
            let ps;
            let mode = "";
            
            if (n <= 4) {
                ps = n;
                mode = "Single (100% Scale)";
            } else if (n % 2 === 0) {
                ps = n / 2;
                mode = "Double (Tiled n/2)";
            } else {
                ps = n;
                mode = "Single (100% Scale)";
            }
            
            const pattern = genPattern(ps);
            const dpr = window.devicePixelRatio || 1;
            
            const shaderUrl = svgGen(dpr, ps, pattern);
            const overlay = document.getElementById('overlay');
            overlay.style.backgroundImage = shaderUrl;
            
            // Scale để hiển thị 2x2 grid (500px container)
            // Mỗi pixel game chiếm 250px.
            // Nếu dùng mẫu ps (size ps), thì background-size phải là (ps * (250/n))
            const zoom = 250 / n;
            overlay.style.backgroundSize = (ps * zoom) + 'px';
            
            document.getElementById('status').textContent = `Int: ${n} | Pattern: ${ps}x${ps} | Mode: ${mode}`;
        }

        run();
    </script>
</body>
</html>
